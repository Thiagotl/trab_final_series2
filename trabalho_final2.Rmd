---
title: "Trabalho Final"
author: "Thiago Tavares Lopes"
date: "`r Sys.Date()`"
output: 
  html_document:
    css: "estilo.css"
    toc: true
    toc_depth: 2
bibliography: referencias.bib
nocite: '@*'
#csl: abnt.csl
---

```{r, include=FALSE}
source("funcoes.R")
library(tidyverse)
library(forecast)
library(TSstudio)
library(lmtest)
library(MASS)
library(kableExtra)
library(knitr)
```


# An√°lise Taxa de Desemprego Alemanha

Nesta se√ß√£o, s√£o apresentados os resultados da an√°lise da taxa de desemprego mensal na Alemanha, no per√≠odo de 1994 a 2016. Como os dados est√£o expressos em porcentagem, foi necess√°rio convert√™-los para propor√ß√µes, dividindo os valores por 100. A s√©rie cont√©m um total de 272 observa√ß√µes, obtidas por meio do sistema de gerenciamento de s√©ries temporais do Banco Central do Brasil.

```{r include=FALSE}
# TAXA DE DESEMPREGO ALEMANHA
taxas_desemprego <- readxl::read_excel("taxas_desempregos.xlsx")
taxas_desemprego <- na.omit(taxas_desemprego[,c(1, 2)])
taxas_desemprego$`3785 - Taxa de desemprego - Alemanha - %`<-as.numeric(taxas_desemprego$`3785 - Taxa de desemprego - Alemanha - %`)
taxas_desemprego$`3785 - Taxa de desemprego - Alemanha - %` <- taxas_desemprego$`3785 - Taxa de desemprego - Alemanha - %`/100 

# PRE√áOS DE OURO
gold_price <- readr::read_csv("gold_price_13to23.csv")

gold_price <- gold_price |> 
  mutate(Date = as.Date(Date, format = "%m/%d/%Y"))

media_mensal <- gold_price |> 
  mutate(Month = floor_date(Date, "month")) |> 
  group_by(Month) |> 
  summarise(Average_Price = mean(Price, na.rm = TRUE))
#View(media_mensal)

```


```{r include=FALSE}
# SERIE DESEMPREGO
serie_desemprego <- ts(taxas_desemprego$`3785 - Taxa de desemprego - Alemanha - %`, start = c(1994, 1), end = c(2016, 6), frequency = 12)

# SERIE GOLD PRICE
serie_gold_price <- ts(media_mensal$Average_Price, start=c(2013,1),  frequency=12)

```

Abaixo temos uma descritiva dos valores da s√©rie e tamb√©m seu *Box-plot*, podemos notar que n√£o h√° presen√ßa de *outliers*. 

```{r}
summary(serie_desemprego)

```
```{r echo=FALSE, fig.align='center'}
boxplot(serie_desemprego)
```

A Figura a seguir exibe a s√©rie temporal da taxa de desemprego mensal na Alemanha no per√≠odo de 1994 a 2016. Verifica-se uma tend√™ncia de aumento na taxa de desemprego entre 2002 e 2005, atingindo seu pico nesse intervalo. A partir de 2006, observa-se um movimento de queda cont√≠nua, o qual se mant√©m at√© o t√©rmino do per√≠odo analisado, indicando uma poss√≠vel recupera√ß√£o sustentada do mercado de trabalho alem√£o.


```{r echo=FALSE, fig.align='center'}

ts.plot(serie_desemprego)

```
Por conseguinte, temos a decomposi√ß√£o da s√©rie para ted√™ncia e sazonalidade:

```{r, echo=FALSE, fig.align='center'}
plot(decompose(serie_desemprego))
```




```{r, echo=FALSE, fig.align='center'}
# library(dygraphs)
# dygraphs::dygraph(serie_desemprego)

```
A avalia√ß√£o da estacionariedade da s√©rie foi conduzida por meio de testes de raiz unit√°ria, conforme apresentado na Tabela 1. Os testes de Augmented Dickey-Fuller (ADF) e Phillips-Perron (PP) n√£o rejeitaram a hip√≥tese nula de presen√ßa de tend√™ncia estoc√°stica (p-valores de 0.5579 e 0.9630, respectivamente), sugerindo que a s√©rie possui raiz unit√°ria. No entanto, o teste KPSS para n√≠vel, cuja hip√≥tese nula √© de estacionariedade em torno de uma m√©dia constante, foi rejeitado (p-valor = 0.0100), corroborando a evid√™ncia de n√£o estacionariedade. Esse conjunto de resultados indica a presen√ßa de uma tend√™ncia estoc√°stica na s√©rie.

A Tabela 2 apresenta os resultados dos testes para identifica√ß√£o de tend√™ncia determin√≠stica. Todos os testes aplicados (Cox-Stuart, Cox and Stuart Trend, Mann-Kendall, Mann-Kendall Trend e KPSS para tend√™ncia) rejeitaram a hip√≥tese nula de aus√™ncia de tend√™ncia (p-valores ‚â§ 0.01), indicando de forma consistente a presen√ßa de uma tend√™ncia determin√≠stica ao longo do tempo.

Por fim, a Tabela 3 resume os resultados dos testes de sazonalidade. O teste de Kruskal-Wallis n√£o rejeitou a hip√≥tese nula de aus√™ncia de sazonalidade (p-valor = 1.0000), enquanto o teste de Friedman detectou evid√™ncia de sazonalidade significativa (p-valor = 0.0181). Assim, embora haja alguma indica√ß√£o de componente sazonal, os resultados s√£o inconclusivos e sugerem que, se presente, a sazonalidade n√£o √© fortemente expressiva.


```{r echo=FALSE}

raiz <- raiz_unit(serie_desemprego) 

raiz$Tabela |> kbl(caption = "Tabela 1: Resultados testes de raiz unit√°ria") |> 
  kable_classic(full_width = F, html_font = "Cambria")

trend <- tend_determ(serie_desemprego)

trend$Tabela |> kbl(caption = "Tabela 2: Resultados teste de tend√™ncia determin√≠stica") |> 
  kable_classic(full_width = F, html_font = "Cambria")


saz <- sazonalidade(serie_desemprego)

saz$Tabela |> kbl(caption = "Tabela 3: Resultados teste de sazonalidade") |> 
  kable_classic(full_width = F, html_font = "Cambria")

```



```{r include=FALSE}

# serie_desemprego_part <- ts_split(serie_desemprego, sample.out = 12)
# serie_desemprego_train <- serie_desemprego_part$train
# serie_desemprego_test <- serie_desemprego_part$test
# 
# 
# modelo1 <- auto.arima(serie_desemprego_train)
# 
# summary(modelo1)
# 
# modelo1_fc <- forecast::forecast(modelo1, h = 12)
# 
# coeftest(modelo1)
# 
# forecast::accuracy(modelo1_fc, serie_desemprego_test)[,c(1:3, 5)]
# 
# AIC(modelo1)
# 
# modelo_sarima <- arima(serie_desemprego_train, order = c(1, 1, 1), list(order = c(0L, 0L, 2), period = 2))
# 
# AIC(modelo_sarima)
# coeftest(modelo_sarima)


# aqui o modelo nao perfomou bem

```

## Ajuste do Modelo
Para investigar a presen√ßa de depend√™ncia de longo prazo na s√©rie temporal da taxa de desemprego, estimou-se o expoente de Hurst por diferentes m√©todos. Conforme apresentado, a estimativa simples baseada no m√©todo R/S (rescaled range) resultou em um valor de 0.8373, enquanto a vers√£o corrigida apresentou um valor ainda mais elevado, de 0.9856. J√° o expoente de Hurst emp√≠rico foi estimado em 0.8267, com a vers√£o corrigida indicando 0.7992. Todos os valores obtidos s√£o significativamente superiores a 0,5, o que evidencia forte persist√™ncia temporal na s√©rie. Isso implica que choques passados tendem a ter efeitos prolongados ao longo do tempo, o que √© caracter√≠stico de processos com mem√≥ria longa.

Adicionalmente, foi estimado o par√¢metro de diferencia√ß√£o fracion√°ria *d* , com valor de 1.1003, indicando que a s√©rie √© fracamente n√£o estacion√°ria e apresenta mem√≥ria longa, uma vez que $0.5<d<1.5$. As estimativas do desvio padr√£o associado, obtidas via aproxima√ß√£o assint√≥tica e via regress√£o, foram de 0.2102 e 0.1232, respectivamente, refor√ßando a robustez da estima√ß√£o de *d*.

Esses resultados sugerem que, para a modelagem adequada da s√©rie, √© necess√°rio considerar abordagens que capturem a estrutura de longa depend√™ncia, como modelos ARFIMA.

```{r, include=FALSE}
# MODELO ARFIMA

library(fracdiff)  # Principal pacote para ARFIMA
library(forecast)  # Para fun√ß√µes auxiliares
library(pracma)

```


```{r, echo=FALSE}
hurstexp(serie_desemprego) # pelos resultados h√° mem√≥ria longa

fdGPH(serie_desemprego)
```

```{r, include=FALSE}
serie_desemprego_diff <- diff(serie_desemprego, d = 1)

fdGPH(serie_desemprego_diff)
```

Por fim, foi considerado um modelo ARFIMA(2, 1, 0), ou seja, dois coeficientes autoregressivos e uma diferencia√ß√£o. Sendo os valores estimados dos par√¢metros  significativos, a 5\% s√£o: $\phi_{1}=0.48, \phi_{2}=0.45, \text{fractional differencing}=-0.26$. Al√©m disso temos, $\text{AIC}=-3775.07, \text{BIC}=-3757.3$. Vale ressaltar que um valor negativo para *fractional differencing* n√£o √© o mais adequado.

```{r, include=FALSE}

# modelo_arfima_desemp <- fracdiff(serie_desemprego_diff, nar = 0, nma=1)
# 
# summary(modelo_arfima_desemp)
# AIC(modelo_arfima_desemp)
# 
# coeftest(modelo_arfima_desemp)

library(arfima)

X = serie_desemprego-mean(serie_desemprego)

X_part <- ts_split(X, sample.out = 12)
X_train <- X_part$train
X_test <- X_part$test

modelo_arfima_desemp2 <- arfima(X_train, order = c(2,1,0))

summary(modelo_arfima_desemp2)

resid<-residuals(modelo_arfima_desemp2)

#AIC(modelo_arfima_desemp2)

pred<-predict(modelo_arfima_desemp2, n.ahead = 12)

```

## An√°lise de res√≠duos e Previs√£o

A Figura apresenta os diagn√≥sticos dos res√≠duos do modelo ajustado. O gr√°fico superior exibe a s√©rie dos res√≠duos ao longo do tempo, os quais oscilam em torno de zero sem apresentar padr√µes sistem√°ticos vis√≠veis, sugerindo aus√™ncia de estrutura temporal remanescente. A an√°lise da fun√ß√£o de autocorrela√ß√£o (ACF), apresentada no gr√°fico inferior esquerdo, demonstra que os res√≠duos n√£o apresentam autocorrela√ß√£o significativa at√© a defasagem 25, uma vez que a maioria dos coeficientes est√° contida dentro dos limites de confian√ßa. A normalidade dos res√≠duos foi avaliada por meio do histograma com sobreposi√ß√£o de uma curva de densidade normal (gr√°fico inferior direito). A distribui√ß√£o dos res√≠duos aproxima-se de uma distribui√ß√£o normal, com leve assimetria, por√©m sem evid√™ncias visuais de desvios em escala.

Por fim, foi realizado o teste de Ljung-Box para avaliar a independ√™ncia dos res√≠duos. O valor do estat√≠stico $Q‚àó=9,5962$ com 10 graus de liberdade resultou em um p-valor de 0,4766. Dessa forma, n√£o se rejeita a hip√≥tese nula de aus√™ncia de autocorrela√ß√£o nos res√≠duos at√© a defasagem 10, indicando que os res√≠duos podem ser considerados independentes ao longo do tempo.

```{r, fig.align='center'}
forecast::checkresiduals(resid$Mode1)
```

Nas imagens abaixo temos acf e pacf dos res√≠duos do modelo ajustado.

```{r, echo=FALSE, fig.align='center'}

acf(resid$Mode1)
pacf(resid$Mode1)

```
Por fim, a Figura abaixo apresenta os valores preditos para os pr√≥ximos 12 per√≠odos, com base no modelo ajustado √† s√©rie temporal. A linha em cinza representa a previs√£o pontual (Exact prediction), enquanto as faixas tracejadas indicam os intervalos de predi√ß√£o com 95% de confian√ßa. O intervalo tracejado em vermelho corresponde ao intervalo de predi√ß√£o exato (Exact 95% PI), enquanto o intervalo tracejado em laranja refere-se ao intervalo assint√≥tico (Limiting 95% PI), o qual se alarga com o aumento do horizonte de previs√£o, refletindo o crescimento da incerteza associada √†s estimativas futuras.

```{r, echo=FALSE, fig.align='center'}

plot(pred, main = "Valores preditos | h = 12")

```


# An√°lise Pre√ßo do Ouro

O ouro √© um ativo financeiro para exporta√ß√£o, investimentos de longo prazo, consumo industrial e c√¢mbio de moedas estrangeiras.  Segundo The Gold Bullion Company, o Brasil ocupa o 7¬∞ lugar no balan√ßo mundial de oferta e demanda de ouro, com este contexto foi feito uma an√°lise da s√©rie hist√≥rica do pre√ßo de comercializa√ß√£o di√°ria do ouro(em quilogramas) entre os anos de 2013 a 2023. O *Dataset* utilizado pode ser acesso neste link do Kaggle [Gold Price Prediction](https://www.kaggle.com/code/farzadnekouei/gold-price-prediction-lstm-96-accuracy). Os dados foram agrupados mensalmente, e ao todo temos 120 observa√ß√µes, o que representaria 120 meses.


```{r, echo=FALSE}
boxplot(serie_gold_price)
```
```{r}
summary(serie_gold_price)
```

A Figura a seguir apresenta a s√©rie temporal dos pre√ßos mensais do ouro no per√≠odo de 2013 a 2023. A partir de uma an√°lise visual preliminar, n√£o se observa evid√™ncia clara de sazonalidade na s√©rie. Destaca-se, entretanto, um aumento expressivo nos pre√ßos entre os anos de 2019 e 2021. 

```{r, echo=FALSE, fig.align='center'}
ts.plot(serie_gold_price)
```

Temos tamb√©m a decomposi√ß√£o da s√©rie para tend√™ncia e sazonalidade na Figura abaixo:

```{r, echo=FALSE, fig.align='center'}
plot(decompose(serie_gold_price))
```
Conforme os resultados apresentados na Tabela 1, os testes de raiz unit√°ria indicam a presen√ßa de uma tend√™ncia estoc√°stica na s√©rie. Tanto o teste de Augmented Dickey-Fuller (ADF) quanto o teste de Phillips-Perron n√£o rejeitam a hip√≥tese nula de presen√ßa de raiz unit√°ria (p-valores de 0.3553 e 0.5252, respectivamente), sugerindo que a s√©rie n√£o √© estacion√°ria. Por outro lado, o teste KPSS rejeita a hip√≥tese nula de estacionariedade em torno de uma m√©dia constante (p-valor = 0.0100), refor√ßando a conclus√£o de n√£o estacionariedade e indicando a presen√ßa de uma tend√™ncia. A Tabela 2 apresenta os resultados dos testes para identifica√ß√£o de tend√™ncia determin√≠stica. Todos os testes aplicados, incluindo Cox-Stuart, Mann-Kendall e KPSS para tend√™ncia, rejeitaram a hip√≥tese nula de aus√™ncia de tend√™ncia com p-valores inferiores a 0.01. Esse conjunto de evid√™ncias confirma a exist√™ncia de uma tend√™ncia determin√≠stica significativa ao longo do tempo, o que √© compat√≠vel com a trajet√≥ria ascendente observada na s√©rie, especialmente a partir de 2019.

A an√°lise de sazonalidade, sumarizada na Tabela 3, foi conduzida por meio dos testes de Kruskal-Wallis e Friedman rank. Em ambos os casos, os p-valores elevados (0.9991 e 0.8554, respectivamente) indicam que n√£o h√° evid√™ncia estat√≠stica para rejeitar a hip√≥tese nula de aus√™ncia de sazonalidade. Assim, conclui-se que a s√©rie n√£o apresenta comportamento sazonal recorrente. Em conjunto, os resultados apontam que a s√©rie √© n√£o estacion√°ria, possui uma tend√™ncia determin√≠stica significativa e n√£o apresenta componentes sazonais, o que deve ser considerado na escolha e especifica√ß√£o de modelos de previs√£o adequados.

```{r, echo=FALSE}

raiz2 <- raiz_unit(serie_gold_price) 

raiz2$Tabela |> kbl(caption = "Tabela 1: Resultados testes de raiz unit√°ria") |> 
  kable_classic(full_width = F, html_font = "Cambria")

trend2 <- tend_determ(serie_gold_price)

trend2$Tabela |> kbl(caption = "Tabela 2: Resultados teste de tend√™ncia determin√≠stica") |> 
  kable_classic(full_width = F, html_font = "Cambria")


saz2 <- sazonalidade(serie_gold_price)

saz2$Tabela |> kbl(caption = "Tabela 3: Resultados teste de sazonalidade") |> 
  kable_classic(full_width = F, html_font = "Cambria")

```


```{r, include=FALSE}
serie_gold_part <- ts_split(serie_gold_price, sample.out = 12)
serie_gold_train <- serie_gold_part$train
serie_gold_test <- serie_gold_part$test
```

### Modelo com Redes Neurais

Ap√≥s a tentativa de ajuste dos modelos cl√°ssicos como  ARMA, ARIMA e SARIMA, os quais n√£o performaram de maneira adequada, optou-se por desenvolver um modelo de no qual se utiliza s√©ries temporais.  

```{r include=FALSE}
fit_netar <- forecast::nnetar(serie_gold_train)

```


```{r include=FALSE}
fit_netar_fc <- forecast::forecast(fit_netar, h = 12)

acuracia<-accuracy(fit_netar_fc, serie_gold_test)[,c(1:3,5)]
acuracia<-as.data.frame(acuracia)
```


A Tabela 4 apresenta os resultados das m√©tricas de avalia√ß√£o do modelo ajustado √† s√©rie temporal de pre√ßos mensais do ouro, considerando os conjuntos de treinamento e teste. As m√©tricas utilizadas incluem o erro m√©dio (ME), a raiz do erro quadr√°tico m√©dio (RMSE), o erro absoluto m√©dio (MAE) e o erro percentual absoluto m√©dio (MAPE).

No conjunto de treinamento, o modelo apresentou desempenho satisfat√≥rio, com erro m√©dio pr√≥ximo de zero (ME = -0.0021), o que indica aus√™ncia de vi√©s sistem√°tico nas previs√µes. O RMSE de 38.17 e o MAE de 29.50 indicam que os erros de previs√£o, em m√©dia, s√£o relativamente baixos, considerando a escala dos dados. O MAPE de 2.16% refor√ßa essa avalia√ß√£o, sinalizando boa acur√°cia relativa das previs√µes no per√≠odo de ajuste.

No entanto, ao se analisar o desempenho no conjunto de teste, observa-se um aumento significativo nos erros. O erro m√©dio passou a 3.23, indicando leve superestima√ß√£o sistem√°tica. O RMSE e o MAE aumentaram para 86.83 e 73.11, respectivamente, sugerindo maior variabilidade e magnitude dos erros. O MAPE alcan√ßou 4.05%, valor ainda aceit√°vel, mas que indica uma queda na precis√£o relativa do modelo fora da amostra.

Esses resultados sugerem que, embora o modelo apresente bom ajuste aos dados hist√≥ricos, seu desempenho preditivo fora da amostra √© sensivelmente inferior, o que pode estar relacionado a mudan√ßas estruturais recentes na s√©rie ou √† presen√ßa de eventos at√≠picos. Assim, a reavalia√ß√£o da estrutura do modelo, bem como o uso de abordagens mais robustas ou modelos com capacidade adaptativa, pode ser recomendada para melhorar a capacidade preditiva.


```{r, echo=FALSE}

acuracia |> kbl(caption = "Tabela 4: M√©tricas de Avalia√ß√£o do Modelo") |> 
  kable_classic(full_width = F, html_font = "Cambria")

```

A Figura apresenta os diagn√≥sticos dos res√≠duos do modelo ajustado √† s√©rie temporal de pre√ßos do ouro. O painel superior exibe o gr√°fico da s√©rie residual ao longo do tempo, o qual n√£o indica a presen√ßa de padr√µes sistem√°ticos ou comportamento estrutural, sugerindo que os res√≠duos se comportam como ru√≠do branco. A an√°lise da fun√ß√£o de autocorrela√ß√£o dos res√≠duos (ACF), mostrada no painel inferior esquerdo, demonstra que a maioria dos coeficientes de autocorrela√ß√£o at√© a defasagem 36 encontra-se dentro dos limites de confian√ßa de 95% (linhas tracejadas azuis), indicando aus√™ncia de autocorrela√ß√£o significativa nas defasagens avaliadas. O histograma dos res√≠duos, no painel inferior direito, mostra uma distribui√ß√£o aproximadamente sim√©trica em torno de zero, com leve curtose e presen√ßa de poucos valores extremos. A curva de densidade ajustada refor√ßa essa proximidade com a distribui√ß√£o normal, embora pequenas assimetrias possam ser observadas. Adicionalmente, o teste de Ljung-Box foi aplicado para avaliar a hip√≥tese de aus√™ncia de autocorrela√ß√£o nos res√≠duos at√© a defasagem 22. O valor do estat√≠stico foi  ùëÑ‚àó=17,917, com 22 graus de liberdade e p-valor de 0{,}7109. Como o p-valor √© elevado, n√£o se rejeita a hip√≥tese nula de que os res√≠duos s√£o independentes. Isso refor√ßa a adequa√ß√£o do modelo ajustado, do ponto de vista da estrutura de depend√™ncia serial dos res√≠duos. 
Em conjunto, os resultados indicam que os res√≠duos do modelo apresentam comportamento satisfat√≥rio, compat√≠vel com as suposi√ß√µes de normalidade e aus√™ncia de autocorrela√ß√£o, o que contribui para a validade das infer√™ncias e previs√µes derivadas do modelo.

```{r, fig.align='center'}
checkresiduals(fit_netar$residuals)

```

Por fim, foram gerados os gr√°ficos de previs√£o que se encontram abaixo.

```{r, echo=FALSE, fig.align='center'}
plot(fit_netar_fc)
```


```{r, echo=FALSE, fig.align='center'}

test_forecast(actual = serie_gold_price,
              forecast.obj = fit_netar_fc,
              test = serie_gold_test)

```

# Refer√™ncias {-}
